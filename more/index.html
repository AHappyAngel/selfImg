<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>个人相册</title>    <link rel="stylesheet" href="../css/waterFall.css"/></head><body><div class="overlay">    <img src="../imgs/load/loading.gif" alt=""></div><div class="container">    <div class="items">        <!--TODO 需要渲染数据的地方-->    </div>    <div class="btn loading">正在加载中...</div></div><!--模版--><script type="text/template" id="items_template">    <%if(model.items && model.items.length){%>    <% for(var i =0 ; i < model.items.length ; i++){%>    <div class="item">        <img src="<%=model.items[i].path%>" alt="">        <p><%=model.items[i].text%></p>    </div>    <% }; %>    <%};%></script><script src="../js/lib/jquery.min.js"></script><!--原生语法--><script src="../js/lib/template-native.js"></script><script src="../js/lib/jquery.waterfall.js"></script><script>    /*接口*/    /*     1.请求方式  get     2.请求url  data.php     3.请求传递的参数   page  当前页数  pageSize  每一页多少条数据     4.是后台在处理     5.返回数据 {page:'下一页的页码',items:[{path:'图片路径',text:'文字'},{},{}...]}     */    /*需求*/    /*     * 1.第一屏默认加载 第一页的数据     * 2.点击加载更多 加载下一页的内容     * 3.点击的时候防止重复提交     * 4.加载数据完成之后  渲染在页面当中     * 5.是瀑布流布局  需要初始化布局方式     * 6.当数据没有的时候  不能在请求的 提示没有更多数据     * 7.当滚动到页面底部一定距离的时候 自动加载     * 【异步加载的是  需要后台返回图片的尺寸】     * */    $(function(){        /*码代码*/        /*获取dom元素*/        /*瀑布流容器渲染*/        var $items = $('.items');        /*加载按钮*/        var $btn = $('.btn');        /*1.第一屏默认加载 第一页的数据*/        /*4.加载数据完成之后  渲染在页面当中*/        /*5.是瀑布流布局  需要初始化布局方式*/        var renderHtml = function(){            $.ajax({                type:'get',                url:'data.php',                dataType:'json',                data:{                    page:$btn.data('page') || 1,/*默认加载第一页*/                    pageSize:15/*条数10条*/                },                beforeSend:function(){                    $btn.addClass('loading').html('正在加载中...');                },                success:function(data){                    //console.log(data);                    /*把数据解析成html结构  渲染在页面当中*/                    var html = template('items_template',{model:data});                    /*var html = template('items_template',data);*/                    //console.log(html);                    $items.append(html);                    /*插件初始化*/                    $items.WaterFall();                    /*渲染完成之后*/                    if(!data.items.length){                        /*6.当数据没有的时候  不能在请求的 提示没有更多数据*/                        $btn.addClass('loading').html('没有更多数据');                    }else{                        $btn.removeClass('loading').html('加载更多');                    }                    /*jquery data（）*/                    /*                     * $('.btn').data('page',10); 设置自定义属性                     * $('.btn').data('page'); 获取自定义属性的值                     * data-page="1" 自定义属性定义的规范 而通过jquery data去拿的是  属性的名称是去掉data-                     *数据的设置是在内存当中                     * */                    $btn.data('page',data.page);                }            });        };        /*初始化第一页数据*/        renderHtml();        /*2.点击加载更多 加载下一页的内容*/        /** 4.加载数据完成之后  渲染在页面当中         * 5.是瀑布流布局  需要初始化布局方式*/        $btn.on('click',function(){            /*3.点击的时候防止重复提交*/            if($btn.hasClass('loading')){                return false;            }            /*兼容下一页*/            renderHtml();        });        /*7.当滚动到页面底部一定距离的时候 自动加载*/        $(window).on('scroll', function () {            /*布局容器 距离顶部的高度*/            var offsetTop = $('.items').offset().top;            /*布局容器的高度*/            var height = $('.items').height();            /*当前文档距离浏览器顶部的高度*/            var scrollTop = $(this).scrollTop();            /*浏览器的高度*/            var winHeight = $(this).height();            /*整个文档多余的高度 */            var offset = offsetTop + height - scrollTop - winHeight;            /* 整个文档多余的高度  小于200的时候 去加载下一页的数据 */            if (offset <= 200 && !$('.btn').hasClass('loading')) {                renderHtml();            }        });    });</script></body></html>